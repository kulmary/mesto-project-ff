(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{KC:()=>N,KS:()=>D,vi:()=>B});var e=function(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",o)},n=function(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)},o=function(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");n(e)}},r=document.querySelector("#card-template").content;function c(t,n,o,c){var i=r.querySelector(".card").cloneNode(!0);i.querySelector(".card__title").textContent=t.name;var a=i.querySelector(".card__image"),u=i.querySelector(".card__likes");i.setAttribute("id",t._id),i.setAttribute("owner_id",t.owner._id),a.src=t.link,a.alt=t.name,u.textContent=t.likes.length;var l=i.querySelector(".card__delete-button"),s=i.querySelector(".card__like-button");return l.addEventListener("click",o),n!==t.owner._id&&l.remove(),t.likes.forEach((function(t){t._id===n&&s.classList.add("card__like-button_is-active")})),a.addEventListener("click",(function(){e(D),B.src=t.link,B.alt=t.name,N.textContent=t.name})),s.addEventListener("click",c),i}function i(t,e,n){t.classList.remove(n.inputErrorClass),e.classList.remove(n.errorClass),e.textContent=t.validationMessage}function a(t,e){t.classList.remove(e.inactiveButtonClass),t.disabled=!1}function u(t,e,n){e?a(t,n):function(t,e){t.classList.add(e.inactiveButtonClass),t.disabled=!0}(t,n)}function l(t,e){var n=t.querySelectorAll(e.inputSelector),o=t.querySelector(e.submitButtonSelector);n.forEach((function(n){i(n,t.querySelector("#".concat(n.name,"-error")),e)})),a(o,e),console.log("clear")}var s=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},d="https://nomoreparties.co/v1/cohort-magistr-2/",p="5ff08c9f-6c39-4cbe-b4be-5b7c70daa1f4",f=document.querySelector(".places__list"),_=document.querySelector(".profile__edit-button"),m=document.querySelector(".popup_type_edit"),v=document.querySelectorAll(".popup__close"),y=document.querySelector(".profile__add-button"),h=document.querySelector(".popup_type_new-card"),S=document.querySelectorAll(".popup"),g=document.querySelector(".profile__image"),b=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),C=document.forms["edit-profile"],q=C.elements.name,E=C.elements.description,L=document.forms["new-place"],x=L.elements["place-name"],A=L.elements.link,T=document.querySelector(".popup_type_update-avatar"),w=document.forms["new-avatar"],j=w.querySelector(".popup__input"),z=w.querySelector(".popup__button"),O=C.querySelector(".popup__button"),P=L.querySelector(".popup__button"),D=document.querySelector(".popup_type_image"),B=document.querySelector(".popup__image"),N=document.querySelector(".popup__caption"),J="",K="",M={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function V(t){var e;t.preventDefault(),(e=t.target.closest(".card").id,fetch("".concat(d,"cards/").concat(e),{method:"DELETE",headers:{authorization:p,"Content-Type":"application/json"},body:JSON.stringify({_id:e})}).then((function(t){return s(t)}))).then((function(){t.target.closest(".card").remove()})).catch((function(t){console.log(t)})).finally((function(){}))}function H(t){var e,n=t.target.closest(".card"),o=n.querySelector(".card__likes");t.target.closest(".card__like-button_is-active")?(console.log("id:",n._id),(e=n.id,fetch("".concat(d,"cards/likes/").concat(e),{method:"DELETE",headers:{authorization:p,"Content-Type":"application/json"}}).then((function(t){return s(t)}))).then((function(e){console.log("LIKE",e),o.textContent=e.likes.length,t.target.classList.toggle("card__like-button_is-active")})).catch((function(t){console.log(t)})).finally((function(){}))):function(t){return fetch("".concat(d,"cards/likes/").concat(t),{method:"PUT",headers:{authorization:p,"Content-Type":"application/json"}}).then((function(t){return s(t)}))}(n.id).then((function(e){console.log("LIKE",e),o.textContent=e.likes.length,t.target.classList.toggle("card__like-button_is-active"),console.log(e)})).catch((function(t){console.log(t)})).finally((function(){}))}!function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);u(o,t.checkValidity(),e),n.forEach((function(n){n.addEventListener("input",(function(){!function(t,e,n){var o=e.validity.valid,r=t.querySelector("#".concat(e.name,"-error"));e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),o?i(e,r,n):function(t,e,n){t.classList.add(n.inputErrorClass),e.classList.add(n.errorClass),e.textContent=t.validationMessage}(e,r,n)}(t,n,e),u(o,t.checkValidity(),e)}))})),t.addEventListener("submit",(function(t){t.preventDefault()}))}(e,t)}))}(M),y.addEventListener("click",(function(){l(L,M),e(h)})),_.addEventListener("click",(function(){q.value=b.textContent,E.value=k.textContent,l(C,M),e(m)})),g.addEventListener("click",(function(){j.value="",l(w,M),e(T)})),w.addEventListener("submit",(function(t){var e;t.preventDefault(),z.textContent="Сохранение...",(e=w.avatar.value,fetch("".concat(d,"users/me/avatar "),{method:"PATCH",headers:{authorization:p,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(t){return s(t)}))).then((function(t){g.removeAttribute("style"),g.setAttribute("style","background-image:url(".concat(t.avatar,")")),n(T)})).catch((function(t){console.log(t)})).finally((function(){z.textContent="Сохранить"}))})),C.addEventListener("submit",(function(t){var e,o;t.preventDefault(),O.textContent="Сохранение...",(e=q.value,o=E.value,fetch("".concat(d,"users/me"),{method:"PATCH",headers:{authorization:p,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:o})}).then((function(t){return s(t)}))).then((function(t){b.textContent=q.value,k.textContent=E.value,n(m)})).catch((function(t){console.log(t)})).finally((function(){O.textContent="Сохранить"}))})),L.addEventListener("submit",(function(t){t.preventDefault(),P.textContent="Сохранение...";var e={name:x.value,link:A.value,likes:[]};e.owner={_id:J},function(t){return fetch("".concat(d,"cards"),{method:"POST",headers:{authorization:p,"Content-Type":"application/json"},body:JSON.stringify({name:t.name,link:t.link})}).then((function(t){return s(t)}))}(e).then((function(e){f.prepend(c(e,J,V,H)),x.value="",A.value="",n(t.target.closest(".popup"))})).catch((function(t){console.log(t)})).finally((function(){P.textContent="Сохранить"}))})),v.forEach((function(t){t.addEventListener("click",(function(t){n(t.target.closest(".popup"))}))})),S.forEach((function(t){t.addEventListener("click",(function(t){t.target===t.currentTarget&&n(t.target)}))})),Promise.all([fetch("".concat(d,"users/me"),{headers:{authorization:p}}).then((function(t){return s(t)})),fetch("".concat(d,"cards"),{headers:{authorization:p,"Content-Type":"application/json"}}).then((function(t){return s(t)}))]).then((function(t){b.textContent=t[0].name,k.textContent=t[0].about,t[0].name,t[0].about,J=t[0]._id,K=t[0].avatar,g.setAttribute("style","background-image:url(".concat(K,")")),t[1].forEach((function(t){var e={name:t.name,link:t.link,likes:t.likes,_id:t._id,owner:{_id:t.owner._id}};f.append(c(e,J,V,H))}))})).catch((function(t){console.log("Ошибка: "+t)})).finally((function(){}))})();